<!--
    Flask åšå®¢ç³»ç»Ÿ - å‰å°åŸºç¡€æ¨¡æ¿ (å“†å•¦Aæ¢¦ä¸»é¢˜)
    æ‰€æœ‰å‰å°é¡µé¢éƒ½ç»§æ‰¿æ­¤æ¨¡æ¿
    ä½¿ç”¨ Bootstrap 5 ä½œä¸º CSS æ¡†æ¶
-->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--
        é¡µé¢æ ‡é¢˜å—
        å­æ¨¡æ¿å¯ä»¥é€šè¿‡ {% raw %}{% block title %}{% endraw %} è¦†ç›–
        é»˜è®¤æ˜¾ç¤º "å“†å•¦Aæ¢¦çš„ç¥å¥‡å£è¢‹"
    -->
    <title>{% block title %}å“†å•¦Aæ¢¦çš„ç¥å¥‡å£è¢‹{% endblock %}</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">

    <!-- è‡ªå®šä¹‰æ ·å¼ -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <!-- é¢å¤–çš„ CSS å— -->
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- ==================== å¯¼èˆªæ  - å“†å•¦Aæ¢¦é£æ ¼ ==================== -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
        <div class="container">
            <!-- ç½‘ç«™ Logo/æ ‡é¢˜ - å“†å•¦Aæ¢¦é“ƒé“› -->
            <a class="navbar-brand fw-bold" href="{{ url_for('index') }}">
                <i class="bi bi-circle-fill me-2"></i>å“†å•¦Aæ¢¦çš„å£è¢‹
            </a>

            <!-- ç§»åŠ¨ç«¯èœå•åˆ‡æ¢æŒ‰é’® -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- å¯¼èˆªèœå• -->
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('index') }}">
                            <i class="bi bi-house-door-fill me-1"></i>å¤§é›„çš„æˆ¿é—´
                        </a>
                    </li>

                    <!-- åˆ†ç±»ä¸‹æ‹‰èœå• -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="categoryDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-folder-fill me-1"></i>å››æ¬¡å…ƒåˆ†ç±»
                        </a>
                        <ul class="dropdown-menu">
                            {% for category in categories %}
                            <li>
                                <a class="dropdown-item" href="{{ url_for('category_posts', category_id=category.id) }}">
                                    ğŸ”” {{ category.name }}
                                    <span class="badge bg-secondary float-end">{{ category.post_count }}</span>
                                </a>
                            </li>
                            {% endfor %}
                        </ul>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('admin_dashboard') }}">
                            <i class="bi bi-gear-fill me-1"></i>ç®¡ç†å®¤
                        </a>
                    </li>
                </ul>

                <!-- æœç´¢è¡¨å• -->
                <form class="d-flex" action="{{ url_for('search') }}" method="GET">
                    <input class="form-control me-2" type="search" name="q" placeholder="ç”¨ç§˜å¯†é“å…·æœç´¢..." required>
                    <button class="btn btn-outline-light" type="submit">
                        <i class="bi bi-search"></i>
                    </button>
                </form>
            </div>
        </div>
    </nav>

    <!-- ==================== å“†å•¦Aæ¢¦è£…é¥° - ä»»æ„é—¨å‰ªå½± ==================== -->
    <div class="doraemon-decoration text-center py-3" style="background: linear-gradient(90deg, transparent, rgba(0,147,214,0.1), transparent);">
        <span style="font-size: 2rem;">ğŸšª âœ¨ ğŸ”” âœ¨ ğŸšª</span>
    </div>

    <!-- ==================== ä¸»å†…å®¹åŒºåŸŸ ==================== -->
    <div class="container mt-4">
        <!-- æ¶ˆæ¯é—ªå­˜æç¤º -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                        <i class="bi bi-bell-fill me-2"></i>{{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="row">
            <!--
                å·¦ä¾§ä¸»å†…å®¹åŒºï¼ˆå  8 åˆ—ï¼‰
                å­æ¨¡æ¿é€šè¿‡ {% raw %}{% block content %}{% endraw %} å¡«å……å†…å®¹
            -->
            <div class="col-lg-8">
                {% block content %}{% endblock %}
            </div>

            <!-- å³ä¾§è¾¹æ ï¼ˆå  4 åˆ—ï¼‰ -->
            <div class="col-lg-4">
                {% block sidebar %}
                <!-- å“†å•¦Aæ¢¦ä¸ªäººç®€ä»‹å¡ç‰‡ -->
                <div class="card mb-4">
                    <div class="card-body text-center">
                        <div style="width: 100px; height: 100px; margin: 0 auto; background: linear-gradient(135deg, #0093D6 0%, #0077B3 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 5px solid #FFD700; box-shadow: 0 5px 20px rgba(0,147,214,0.3);">
                            <span style="font-size: 50px;">ğŸ˜º</span>
                        </div>
                        <h5 class="card-title mt-3">å“†å•¦Aæ¢¦</h5>
                        <p class="card-text text-muted">æ¥è‡ª22ä¸–çºªçš„çŒ«å‹æœºå™¨äººï¼Œå¸®åŠ©å¤§é›„è§£å†³å„ç§å›°éš¾ï¼</p>
                        <div class="d-flex justify-content-center gap-3">
                            <a href="#" class="text-primary" style="font-size: 1.5rem;">ğŸ””</a>
                            <a href="#" class="text-info" style="font-size: 1.5rem;">ğŸšª</a>
                            <a href="#" class="text-danger" style="font-size: 1.5rem;">ğŸˆ</a>
                        </div>
                    </div>
                </div>

                <!-- æ ‡ç­¾äº‘ -->
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <i class="bi bi-tags-fill me-2"></i>ç§˜å¯†é“å…·
                    </div>
                    <div class="card-body">
                        {% if tags %}
                            {% for tag in tags %}
                                <a href="{{ url_for('tag_posts', tag_id=tag.id) }}" class="btn btn-sm btn-outline-primary mb-2">
                                    ğŸ”§ {{ tag.name }}
                                    <span class="badge bg-secondary">{{ tag.post_count }}</span>
                                </a>
                            {% endfor %}
                        {% else %}
                            <p class="text-muted mb-0">é“å…·æ­£åœ¨è¡¥å……ä¸­...</p>
                        {% endif %}
                    </div>
                </div>

                <!-- æœ€æ–°æ–‡ç«  -->
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <i class="bi bi-clock-history me-2"></i>æœ€æ–°å†’é™©
                    </div>
                    <ul class="list-group list-group-flush">
                        {% for post in recent_posts %}
                        <li class="list-group-item">
                            <a href="{{ url_for('post_detail', post_id=post.id) }}" class="text-decoration-none">
                                ğŸŒŸ {{ post.title }}
                            </a>
                            <small class="text-muted d-block">{{ post.created_at.strftime('%Y-%m-%d') }}</small>
                        </li>
                        {% else %}
                        <li class="list-group-item text-muted">è¿˜æ²¡æœ‰å†’é™©æ•…äº‹...</li>
                        {% endfor %}
                    </ul>
                </div>

                <!-- çƒ­é—¨æ–‡ç«  -->
                <div class="card mb-4">
                    <div class="card-header bg-warning text-dark">
                        <i class="bi bi-fire me-2"></i>çƒ­é—¨å†’é™©
                    </div>
                    <ul class="list-group list-group-flush">
                        {% for post in popular_posts %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <a href="{{ url_for('post_detail', post_id=post.id) }}" class="text-decoration-none text-truncate" style="max-width: 80%;">
                                ğŸ”¥ {{ post.title }}
                            </a>
                            <span class="badge bg-danger rounded-pill">{{ post.views }}</span>
                        </li>
                        {% else %}
                        <li class="list-group-item text-muted">è¿˜æ²¡æœ‰çƒ­é—¨å†’é™©...</li>
                        {% endfor %}
                    </ul>
                </div>

                <!-- åˆ†ç±»ç»Ÿè®¡ -->
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <i class="bi bi-folder2-open me-2"></i>å››æ¬¡å…ƒåˆ†ç±»
                    </div>
                    <ul class="list-group list-group-flush">
                        {% for category in categories %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <a href="{{ url_for('category_posts', category_id=category.id) }}" class="text-decoration-none">
                                ğŸ“ {{ category.name }}
                            </a>
                            <span class="badge bg-primary rounded-pill">{{ category.post_count }}</span>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endblock %}
            </div>
        </div>
    </div>

    <!-- ==================== é¡µè„š - å“†å•¦Aæ¢¦é£æ ¼ ==================== -->
    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container text-center">
            <p class="mb-2" style="font-size: 1.2rem;">
                ğŸ”” åªè¦æœ‰å“†å•¦Aæ¢¦åœ¨ï¼Œæ¢¦æƒ³å°±èƒ½å®ç° ğŸ””
            </p>
            <p class="mb-1">&copy; {{ now.year }} å“†å•¦Aæ¢¦çš„ç¥å¥‡å£è¢‹. All rights reserved.</p>
            <p class="mb-0">
                <small>
                    Powered by <a href="https://flask.palletsprojects.com/" class="text-white" target="_blank">Flask</a>
                    & <span style="color: #FFD700;">ğŸ’™ å“†å•¦Aæ¢¦ ğŸ’›</span>
                </small>
            </p>
        </div>
    </footer>

    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- è‡ªå®šä¹‰ JS -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>

    <!-- é¢å¤–çš„ JS å— -->
    {% block extra_js %}{% endblock %}
</body>
</html>
